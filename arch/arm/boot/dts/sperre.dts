/*
 * Copyright DATA RESPONS AS
 *
 * The code contained herein is licensed under the GNU General Public
 * License. You may obtain a copy of the GNU General Public License
 * Version 2 or later at the following locations:
 *
 * http://www.opensource.org/licenses/gpl-license.html
 * http://www.gnu.org/copyleft/gpl.html
 */
 
/dts-v1/;

#include "imx6dl.dtsi"
#include <dt-bindings/input/input.h>
#include <dt-bindings/gpio/gpio.h>
/ {
    model = "Sperre";
    compatible = "datarespons,laerdal2";
    
    aliases {
    	mxcfb0 = &mxcfb1;
		mxcfb1 = &mxcfb2;
        mmc0 = &usdhc4;
        rtc0 = &main_rtc;
    };
    
    memory {
        reg = <0x10000000 0x40000000>;
    };
    
    regulators {
        compatible = "simple-bus";

        reg_usb_h1_vbus: usb_h1_vbus {
            compatible = "regulator-fixed";
            regulator-name = "usb_h1_vbus";
            regulator-min-microvolt = <5000000>;
            regulator-max-microvolt = <5000000>;
            gpio = <&gpio3 31 GPIO_ACTIVE_LOW>;
            enable-active-low;
        };
    
        reg_usb_otg_vbus: usb_otg_vbus {
            compatible = "regulator-fixed";
            regulator-name = "usb_otg_vbus";
            regulator-min-microvolt = <5000000>;
            regulator-max-microvolt = <5000000>;
            gpio = <&gpio3 22 GPIO_ACTIVE_LOW>;
            enable-active-low;
            //vin-supply = <&reg_5v>;	// to be done and checked
        };
        
        reg_fec_supply: fec_supply {
            compatible = "regulator-fixed";
            regulator-name = "fec_vbus";
            regulator-min-microvolt = <3300000>;
            regulator-max-microvolt = <3300000>;
            regulator-boot-on;
			regulator-always-on;
        };
        
        reg_bl_vdd: bl_vdd {
            compatible = "regulator-fixed";
            regulator-name = "bl_vdd";
            regulator-min-microvolt = <5000000>;
            regulator-max-microvolt = <5000000>;
            regulator-boot-on;
			regulator-always-on;
        };
        
        reg_vdd_supply: vdd_supply {
        	compatible = "regulator-fixed";
            regulator-name = "adc_vdd";
            regulator-min-microvolt = <12000000>;
            regulator-max-microvolt = <12000000>;
            regulator-boot-on;
			regulator-always-on;
        };
    };
    
    gpio-keys {
        compatible = "gpio-keys";
        
    };
    
    backlight  {
        compatible = "pwm-backlight";
        pwms = <&pwm1 0 5000000>;
        brightness-levels = < 0 1 2 3 4 5 6 8  11 16  23  32 48
                              64 81 100 121 144 169 196 225>;
        default-brightness-level = <20>;
        power-supply = <&reg_bl_vdd>;
        //enable-gpios = <&gpio4 15 GPIO_ACTIVE_LOW>;
        default-on;
    };
    
    /* LVDS screen */
    mxcfb1: fb@0 {
    		compatible = "fsl,mxc_sdc_fb";
	        disp_dev = "ldb";
	        interface_pix_fmt = "RGB666";
	        default_bpp = <16>;
	        mode_str ="SPERRE-WVGA";
	        int_clk = <0>;
	        late_init = <0>;
	        status = "okay";
    };
    
    /* HDMI will not be used */
	mxcfb2: fb@1 {
	        compatible = "fsl,mxc_sdc_fb";
        	disp_dev = "hdmi";
			interface_pix_fmt = "RGB24";
			mode_str = "1920x1080M@60";
			default_bpp = <0x18>;
			int_clk = <0x0>;
			late_init = <0x0>;
			status = "disabled";
    };
    
	user-gpios {
        gpio-lcd-pwr-enable {
            gpios = <&gpio1 0 GPIO_ACTIVE_LOW>;
            status = "okay";
            value = <1>;
        };
        
        gpio-lcd-bl-enable {
            gpios = <&gpio4 15 GPIO_ACTIVE_LOW>;
            status = "okay";
            value = <1>;
        };
        
        gpio-mmc-rst {
            gpios = <&gpio1 7 GPIO_ACTIVE_LOW>;
            status = "okay";
            value = <0>;
        };
        gpio-touch-rst {
            gpios = <&gpio7 12 GPIO_ACTIVE_LOW>;
            status = "okay";
            value = <1>;
        };
        
        gpio-pmic-gpio {
            gpios = <&gpio7 13 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <1>;
        };
        
        gpio-rs485-rts {
        	gpios = <&gpio3 29 GPIO_ACTIVE_LOW>;
        	status = "okay";
        	value = <1>;
        };
        
        gpio-rs485-en1 {
            gpios = <&gpio4 6 GPIO_ACTIVE_LOW>;
            status = "okay";
            value = <0>;
        };
        
        gpio-rs485-en2 {
            gpios = <&gpio4 7 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <1>;
        };
        
        gpio-spinor-wp {
            gpios = <&gpio4 14 GPIO_ACTIVE_LOW>;
            status = "okay";
            value = <1>;
        };

		/* RELAYS GPIOS */
        gpio-relay-1 {
        	gpios = <&gpio2 0 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
        gpio-relay-2 {
        	gpios = <&gpio2 1 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
        gpio-relay-3 {
        	gpios = <&gpio2 2 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
        gpio-relay-4 {
        	gpios = <&gpio2 3 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
        gpio-relay-5 {
        	gpios = <&gpio2 4 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
        gpio-relay-6 {
        	gpios = <&gpio2 5 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
        gpio-relay-7 {
        	gpios = <&gpio2 6 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
        gpio-relay-8 {
        	gpios = <&gpio2 7 GPIO_ACTIVE_HIGH>;
            status = "okay";
            value = <0>;
        };
        
    };
    
    leds {
        compatible = "gpio-leds";
    
        debug-red {
        	gpios = <&gpio1 2 GPIO_ACTIVE_HIGH>;
            default-state = "off";
        };
    };
};

/* Digital Input */
&ecspi1 {
    fsl,spi-num-chipselects = <1>;
    cs-gpios = <&gpio5 17 GPIO_ACTIVE_LOW>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_ecspi1>;
    status = "okay";
    
    di: max31913@0 {
       compatible = "maxim,max31913";
       reg = <0>;
       spi-max-frequency = <10000>;
    };
};

/* Analog Input */
&ecspi2 {
    fsl,spi-num-chipselects = <1>;
    cs-gpios = <&gpio5 12 GPIO_ACTIVE_LOW>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_ecspi2>;
    status = "okay";
    
    adc: ad7327@0 {
       compatible = "ti,ad7327";
       reg = <0>;
       vref-supply = <&reg_vdd_supply>;
       spi-max-frequency = <100000>;
    };
};

/* NOR FLASH SPI3 */
&ecspi3 {
    fsl,spi-num-chipselects = <1>;
    cs-gpios = <&gpio4 24 GPIO_ACTIVE_LOW>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_ecspi3>;
    status = "okay";

    flash: w25q32@0 {
        #address-cells = <1>;
        #size-cells = <1>;
        compatible = "winbond,w25q32", "jedec,spi-nor";
        spi-max-frequency = <20000000>;
        reg = <0>;
        partition@0 {
            label = "user";
            reg = <0 0x00200000>;
        };
        partition@0x00200000 {
            label = "factory";
            reg = <0x00200000 0x00200000>;
        };
    };
};

&fec {
    compatible = "fsl,imx6q-fec";
	status = "okay";
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_enet>;
	phy-mode = "rmii";
	fsl,magic-packet;
	phy-reset-gpios = <&gpio6 14 GPIO_ACTIVE_LOW>;
	phy-reset-duration = <5>;
	phy-supply = <&reg_fec_supply>;
	phy-handle = <&ethphy>;
	assigned-clocks = <&clks IMX6QDL_CLK_ENET_REF>;
	assigned-clock-rates = <50000000>;
    mdio {
       #address-cells = <1>;
       #size-cells = <0>;
       ethphy: ethernet-phy@0 {
           compatible = "ethernet-phy-ieee802.3-c22";
           reg = <0x0>;
           //max-speed = <100>;
           smsc,disable-energy-detect;
           interrupt-parent = <&gpio1>;
           interrupts = <9 IRQ_TYPE_EDGE_FALLING>;
       };
    };
};


&cpu0 {
    arm-supply = <&reg_arm>;
    soc-supply = <&reg_soc>;
};

&gpc {
    fsl,ldo-bypass = <0>; /* use ldo-bypass, u-boot will check it and configure */
};


/* There is no watchdog? */
/*&wdog1 {
    status = "disabled";
};*/

&i2c1 {
    clock-frequency = <100000>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_i2c1>;
    status = "okay";
};

&i2c2 {
    clock-frequency = <100000>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_i2c2>;
    status = "okay";
    
    pfuze100@08 {
		compatible = "fsl,pfuze100";
		reg = <0x8>;

		regulators {

			sw1ab {
				regulator-min-microvolt = <0x493e0>;
				regulator-max-microvolt = <0x1c9c38>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <0x186a>;
				linux,phandle = <0x2a>;
				phandle = <0x2a>;
			};

			sw1c {
				regulator-min-microvolt = <0x493e0>;
				regulator-max-microvolt = <0x1c9c38>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <0x186a>;
				linux,phandle = <0x2b>;
				phandle = <0x2b>;
			};

			sw2 {
				regulator-min-microvolt = <0xc3500>;
				regulator-max-microvolt = <0x325aa0>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw3a {
				regulator-min-microvolt = <0x61a80>;
				regulator-max-microvolt = <0x1e22d8>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw3b {
				regulator-min-microvolt = <0x61a80>;
				regulator-max-microvolt = <0x1e22d8>;
				regulator-boot-on;
				regulator-always-on;
			};

			sw4 {
				regulator-min-microvolt = <0xc3500>;
				regulator-max-microvolt = <0x325aa0>;
			};

			swbst {
				regulator-min-microvolt = <0x4c4b40>;
				regulator-max-microvolt = <0x4e9530>;
			};

			vsnvs {
				regulator-min-microvolt = <0xf4240>;
				regulator-max-microvolt = <0x2dc6c0>;
				regulator-boot-on;
				regulator-always-on;
			};

			vrefddr {
				regulator-boot-on;
				regulator-always-on;
			};

			vgen1 {
				regulator-min-microvolt = <0xc3500>;
				regulator-max-microvolt = <0x17a6b0>;
			};

			vgen2 {
				regulator-min-microvolt = <0xc3500>;
				regulator-max-microvolt = <0x17a6b0>;
			};

			vgen3 {
				regulator-min-microvolt = <0x1b7740>;
				regulator-max-microvolt = <0x325aa0>;
			};

			vgen4 {
				regulator-min-microvolt = <0x1b7740>;
				regulator-max-microvolt = <0x325aa0>;
				regulator-always-on;
			};

			vgen5 {
				regulator-min-microvolt = <0x1b7740>;
				regulator-max-microvolt = <0x325aa0>;
				regulator-always-on;
			};

			vgen6 {
				regulator-min-microvolt = <0x1b7740>;
				regulator-max-microvolt = <0x325aa0>;
				regulator-always-on;
			};
		};
	};

	tsc2004@4b {
		compatible = "ti,tsc2004";
		reg = <0x4b>;
		gpios = <&gpio1 5 GPIO_ACTIVE_LOW>,         /* Touch INT */
                <&gpio7 12 GPIO_ACTIVE_LOW>;        /* Touch RST */
		reset-gpios = <&gpio7 12 GPIO_ACTIVE_LOW>;
		interrupt-parent = <&gpio1>;
		interrupts = <5 IRQ_TYPE_EDGE_FALLING>;
		ti,x-plate-ohms = <280>;
        status = "okay";
	};
};

&i2c3 {
    clock-frequency = <400000>;
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_i2c3>;
    status = "okay";
    
    main_rtc: s35390a@0x30 {
		compatible = "sii,s35390a";
		reg = <0x30>;
	};
};

&iomuxc {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_hog_1>;

    hog {
    	/* TO BE FINISHED, hoggrp-1 needs correct pinctrl setup */
        pinctrl_hog_1: hoggrp-1 {
            fsl,pins = <
            MX6QDL_PAD_GPIO_17__GPIO7_IO12		0x80000000		/* TOUCH_RES */
            MX6QDL_PAD_GPIO_5__GPIO1_IO05		0x0001b8b1		/* TOUCH_IRQ */
            MX6QDL_PAD_GPIO_18__GPIO7_IO13		0x80000000		/* PMIC_INT_B */
            MX6QDL_PAD_GPIO_7__GPIO1_IO07		0x80000000		/* MMC_RST */
            >;
        };
    };

    ecspi1 {
        pinctrl_ecspi1: ecspi1grp {
            fsl,pins = <
            	/* Digital Input */
                MX6QDL_PAD_DISP0_DAT20__ECSPI1_SCLK 	0x100b1
                //MX6QDL_PAD_DISP0_DAT21__ECSPI1_MOSI 	0x100b1		/* this PAD is not used at all */
                MX6QDL_PAD_DISP0_DAT22__ECSPI1_MISO 	0x100b1
                MX6QDL_PAD_DISP0_DAT23__GPIO5_IO17  	0x100b1		/* SPI1_CS0 */
            >;
        };
    };
    
    ecspi2 {
        pinctrl_ecspi2: ecspi2grp {
            fsl,pins = <
                MX6QDL_PAD_DISP0_DAT19__ECSPI2_SCLK 	0x100b1
                MX6QDL_PAD_DISP0_DAT16__ECSPI2_MOSI 	0x100b1
                MX6QDL_PAD_DISP0_DAT17__ECSPI2_MISO 	0x100b1
                MX6QDL_PAD_DISP0_DAT18__GPIO5_IO12  	0x100b1		/* SPI2_CS0 */
            >;
        };
    };
    
    ecspi3 {
        pinctrl_ecspi3: ecspi3grp {
            fsl,pins = <
                MX6QDL_PAD_DISP0_DAT0__ECSPI3_SCLK		0x100b1
                MX6QDL_PAD_DISP0_DAT1__ECSPI3_MOSI		0x100b1
                MX6QDL_PAD_DISP0_DAT2__ECSPI3_MISO		0x100b1
                MX6QDL_PAD_DISP0_DAT3__GPIO4_IO24		0x100b1
            >;
        };
    };
    
    uart1 {
        pinctrl_uart1: uart1grp {
            fsl,pins = <
                MX6QDL_PAD_CSI0_DAT10__UART1_TX_DATA    0x1b0b1
                MX6QDL_PAD_CSI0_DAT11__UART1_RX_DATA    0x1b0b1
            >;
        };
    };
    
    uart2 {
        pinctrl_uart2: uart2grp {
            fsl,pins = <
                MX6QDL_PAD_EIM_D26__UART2_TX_DATA    0x1b0b1
                MX6QDL_PAD_EIM_D27__UART2_RX_DATA    0x1b0b1
                MX6QDL_PAD_EIM_D28__UART2_CTS_B		 0x1b0b1
            >;
        };
    };
    
    pwm1 {
        pinctrl_pwm1: pwm1grp {
            fsl,pins = <
                MX6QDL_PAD_SD1_DAT3__PWM1_OUT       0x1b0b1
            >;
        };
    };
    
    i2c1 {
        pinctrl_i2c1: i2c1grp {
            fsl,pins = <
                MX6QDL_PAD_CSI0_DAT9__I2C1_SCL		0x4001b8b1
                MX6QDL_PAD_CSI0_DAT8__I2C1_SDA		0x4001b8b1
            >;
        };
    };
    
    i2c2 {
        pinctrl_i2c2: i2c2grp {
            fsl,pins = <
                MX6QDL_PAD_KEY_COL3__I2C2_SCL		0x4001b8b1
                MX6QDL_PAD_KEY_ROW3__I2C2_SDA		0x4001b8b1
            >;
        };
    };
    
    i2c3 {
        pinctrl_i2c3: i2c3grp {
            fsl,pins = <
                MX6QDL_PAD_GPIO_3__I2C3_SCL		0x4001b8b1
                MX6QDL_PAD_GPIO_6__I2C3_SDA		0x4001b8b1
            >;
        };
    };
    
    usbh1 {
        pinctrl_usbh1: usbh1grp {
            fsl,pins = <
                MX6QDL_PAD_EIM_D30__USB_H1_OC		0x17059
                MX6QDL_PAD_EIM_D31__USB_H1_PWR      0x80000000
            >;
        };
    };
    
    usbotg {
        pinctrl_usbotg: usbotggrp {
            fsl,pins = <
                //MX6QDL_PAD_ENET_RX_ER__USB_OTG_ID   0x17059
                MX6QDL_PAD_EIM_D21__USB_OTG_OC      0x17059
                MX6QDL_PAD_EIM_D22__GPIO3_IO22      0x80000000
                 
            >;
        };
    };

    usdhc4 {
        pinctrl_usdhc4: usdhc4grp {
            fsl,pins = <
                MX6QDL_PAD_SD4_CLK__SD4_CLK			0x17059
                MX6QDL_PAD_SD4_CMD__SD4_CMD			0x10059
                MX6QDL_PAD_SD4_DAT0__SD4_DATA0      0x17059
                MX6QDL_PAD_SD4_DAT1__SD4_DATA1      0x17059
                MX6QDL_PAD_SD4_DAT2__SD4_DATA2      0x17059
                MX6QDL_PAD_SD4_DAT3__SD4_DATA3      0x17059
                MX6QDL_PAD_SD4_DAT4__SD4_DATA4      0x17059
                MX6QDL_PAD_SD4_DAT5__SD4_DATA5      0x17059
                MX6QDL_PAD_SD4_DAT6__SD4_DATA6      0x17059
                MX6QDL_PAD_SD4_DAT7__SD4_DATA7      0x17059
            >;
        };
    };
    
    enet {        
        pinctrl_enet: enetgrp {
            fsl,pins = <
            	MX6QDL_PAD_ENET_MDC__ENET_MDC			0x1b0b0
            	MX6QDL_PAD_ENET_MDIO__ENET_MDIO			0x1b0b0
            	MX6QDL_PAD_ENET_CRS_DV__ENET_RX_EN		0x1b0b0
            	MX6QDL_PAD_ENET_RX_ER__ENET_RX_ER		0x1b0b0
            	MX6QDL_PAD_ENET_TX_EN__ENET_TX_EN		0x1b0b0
            	MX6QDL_PAD_ENET_RXD0__ENET_RX_DATA0		0x1b0b0
            	MX6QDL_PAD_ENET_RXD1__ENET_RX_DATA1		0x1b0b0
            	MX6QDL_PAD_ENET_TXD0__ENET_TX_DATA0		0x1b0b0
            	MX6QDL_PAD_ENET_TXD1__ENET_TX_DATA1		0x1b0b0
				MX6QDL_PAD_GPIO_16__ENET_REF_CLK		0x4001b0a8
				
				/* LAN8720 PHY Reset */
				MX6QDL_PAD_NANDF_CS1__GPIO6_IO14		0x1b0b0		/* RMII_nRST  */
				MX6QDL_PAD_GPIO_9__GPIO1_IO09			0x1b0b0		/* RMII_INT */
            >;
        };
    };
};

&ldb {
    status = "okay";

	mode = "sin1";

	/* lvds-channel 0 will not be used */
    lvds-channel@0 {
    	reg = <0>;
    	status = "disabled";
        fsl,data-mapping = "spwg";
        fsl,data-width = <18>;
        crtc = "ipu1-di0";

        display-timings {
            native-mode = <&timing0>;
            timing0: hsd100pxn1 {
                clock-frequency = <65000000>;
                hactive = <800>;
                vactive = <480>;
                hback-porch = <220>;
                hfront-porch = <40>;
                vback-porch = <21>;
                vfront-porch = <7>;
                hsync-len = <60>;
                vsync-len = <10>;
            };
        };
    };

    lvds-channel@1 {
    	reg = <1>;
    	status = "okay";
        fsl,data-mapping = "spwg";
        fsl,data-width = <18>;
        status = "okay";
        primary;
        crtc = "ipu1-di1";

        display-timings {
            native-mode = <&timing1>;
            timing1: hsd100pxn1 {
                clock-frequency = <33260000>;
                hactive = <800>;
                vactive = <480>;
                hback-porch = <80>;
                hfront-porch = <40>;
                vback-porch = <10>;
                vfront-porch = <10>;
                hsync-len = <20>;
                vsync-len = <10>;
            };
        };
    };
};

&pcie {
    status = "disabled";
};

&uart1 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_uart1>;
    status = "okay";
};

&uart2 {
	compatible = "fsl,imx6q-uart", "fsl,imx21-uart";
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_uart2>;
    // RTS GPIO - MX6QDL_PAD_EIM_D29__GPIO3_IO29
    rts-gpio = <&gpio3 29 GPIO_ACTIVE_LOW>;
    fsl,uart-has-rtscts;
    status = "okay";
};

&usbh1 {
	pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_usbh1>;
    //vbus-supply = <&reg_usb_h1_vbus>;
    status = "okay";
};

&usbotg {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_usbotg>;
    vbus-supply = <&reg_usb_otg_vbus>;
    disable-over-current;
    srp-disable;
    hnp-disable;
    adp-disable;
    status = "okay";
};

&usdhc1 {
    status = "disabled";
};

&usdhc2 {
    status = "disabled";
};

&usdhc3 {
    status = "disabled";
};

&usdhc4 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_usdhc4>;
    bus-width = <8>;
    non-removable;
    keep-power-in-suspend;
    enable-sdio-wakeup;
    status = "okay";
};

&pwm1 {
    pinctrl-names = "default";
    pinctrl-0 = <&pinctrl_pwm1>;
    status = "okay";
};

&epdc {
    status = "disabled";
};

&audmux {
    status = "disabled";
};

&clks {
    assigned-clocks = <&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>,
              <&clks IMX6QDL_PLL4_BYPASS>,
              <&clks IMX6QDL_CLK_ESAI_SEL>,
              <&clks IMX6QDL_CLK_ESAI_EXTAL>;
    assigned-clock-parents = <&clks IMX6QDL_CLK_PLL4_POST_DIV>,
                <&clks IMX6QDL_CLK_PLL4>, <&clks IMX6QDL_CLK_PLL4_AUDIO_DIV>;
    assigned-clock-rates = <786432000>, <0>, <0>, <24576000>;
};

&ssi2 {
    fsl,mode = "i2s-slave";
    status = "okay";
};

&esai {
    status = "disabled";
};

&snvs_poweroff {
	status = "okay";
};
